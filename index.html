<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>潮州话在线字典</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Noto+Serif+SC:wght@400;600&display=swap" rel="stylesheet">
    <!-- 添加SheetJS库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px 0;
            border-bottom: 1px solid #eaeaea;
            position: relative;
        }

        h1 {
            font-family: 'Noto Serif SC', serif;
            color: #2c5aa0;
            font-size: 2.8rem;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.2rem;
            font-weight: 300;
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
        }

        .search-section {
            flex: 1;
            min-width: 300px;
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .results-section {
            flex: 2;
            min-width: 300px;
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .search-box {
            position: relative;
            margin-bottom: 25px;
        }

        .search-box input {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.1rem;
            border: 2px solid #ddd;
            border-radius: 30px;
            outline: none;
            transition: all 0.3s;
        }

        .search-box input:focus {
            border-color: #2c5aa0;
            box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
        }

        .search-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background-color: #2c5aa0;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        .search-btn:hover {
            background-color: #1e3d73;
        }

        .recent-searches {
            margin-top: 20px;
        }

        .recent-title {
            font-size: 0.9rem;
            color: #777;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .recent-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .recent-tag {
            background-color: #f0f4ff;
            color: #2c5aa0;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .recent-tag:hover {
            background-color: #2c5aa0;
            color: white;
        }

        .section-title {
            font-family: 'Noto Serif SC', serif;
            font-size: 1.5rem;
            color: #2c5aa0;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f4ff;
        }

        .word-card {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 10px;
            background-color: #f8faff;
            border-left: 5px solid #2c5aa0;
            transition: transform 0.3s;
        }

        .word-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .word-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .word-title {
            font-size: 1.8rem;
            color: #1e3d73;
            font-weight: 700;
        }

        .pronunciation {
            color: #d35400;
            font-size: 1.1rem;
            margin-top: 5px;
        }

        .audio-image-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .play-audio {
            background-color: #e74c3c;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            text-decoration: none;
        }

        .play-audio:hover {
            background-color: #c0392b;
        }

        .view-image-btn {
            background-color: #3498db;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            text-decoration: none;
        }

        .view-image-btn:hover {
            background-color: #2980b9;
        }

        .view-image-btn.disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }

        .view-image-btn.disabled:hover {
            background-color: #7f8c8d;
        }

        .word-info {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-box {
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
        }

        .info-label {
            font-size: 0.9rem;
            color: #777;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-content {
            font-size: 1.1rem;
            color: #333;
            line-height: 1.5;
        }

        .example {
            margin-top: 15px;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            border-left: 3px solid #27ae60;
        }

        .example-text {
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .example-translation {
            color: #666;
            font-style: italic;
        }

        .related-languages {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }

        .language-item {
            padding: 8px 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .language-name {
            font-weight: bold;
            color: #2c5aa0;
        }

        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px 0;
            color: #777;
            font-size: 0.9rem;
            border-top: 1px solid #eaeaea;
        }

        .no-results {
            text-align: center;
            padding: 40px 20px;
            color: #777;
        }

        .quick-submit-btn {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(39, 174, 96, 0.2);
        }

        .quick-submit-btn:hover {
            background-color: #219653;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(39, 174, 96, 0.3);
        }

        .fuzzy-results {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .fuzzy-title {
            font-size: 0.9rem;
            color: #777;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .fuzzy-item {
            padding: 10px 15px;
            margin-bottom: 8px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #3498db;
            cursor: pointer;
            transition: all 0.3s;
        }

        .fuzzy-item:hover {
            background-color: #e3f2fd;
            transform: translateX(5px);
        }

        .fuzzy-word {
            font-weight: bold;
            color: #2c5aa0;
        }

        .fuzzy-pronunciation {
            color: #d35400;
            font-size: 0.9rem;
        }

        .edit-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .admin-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .admin-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.3s;
            flex: 1;
            justify-content: center;
            position: relative;
        }

        .admin-btn:hover {
            background-color: #2980b9;
        }

        #toggle-recycle-bin {
            background-color: #95a5a6;
        }

        #toggle-recycle-bin:hover {
            background-color: #7f8c8d;
        }

        .edit-toggle-btn {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.3s;
            width: 100%;
            justify-content: center;
        }

        .edit-toggle-btn:hover {
            background-color: #219653;
        }

        .password-prompt {
            margin-top: 20px;
            padding: 20px;
            background-color: #fff8e1;
            border-radius: 8px;
            border-left: 4px solid #ffb300;
        }

        .password-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .password-input:focus {
            border-color: #2c5aa0;
            box-shadow: 0 0 0 2px rgba(44, 90, 160, 0.1);
            outline: none;
        }

        .password-btn {
            background-color: #ffb300;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }

        .password-btn:hover {
            background-color: #ff8f00;
        }

        .edit-form {
            margin-top: 20px;
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 8px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .form-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }

        .submit-btn {
            background-color: #2c5aa0;
            color: white;
        }

        .submit-btn:hover {
            background-color: #1e3d73;
        }

        .cancel-btn {
            background-color: #95a5a6;
            color: white;
        }

        .cancel-btn:hover {
            background-color: #7f8c8d;
        }

        .add-example-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .add-example-btn:hover {
            background-color: #2980b9;
        }

        .example-item {
            background-color: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            border: 1px solid #eee;
        }

        .remove-example-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .remove-example-btn:hover {
            background-color: #c0392b;
        }

        .delete-word-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
            margin-top: 10px;
        }

        .delete-word-btn:hover {
            background-color: #c0392b;
        }

        .current-edit-title {
            margin-top: 20px;
            color: #2c5aa0;
            font-size: 1.2rem;
        }

        .error-message {
            color: #e74c3c;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .success-message {
            color: #27ae60;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .admin-panel-container {
            margin-top: 20px;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            display: none;
        }

        .admin-panel-container h4 {
            margin-bottom: 15px;
            color: #2c5aa0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-panel {
            background: none;
            border: none;
            color: #777;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .pending-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .pending-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            background-color: #f9f9f9;
            border-left: 4px solid #3498db;
        }

        .pending-item.recycle-item {
            border-left-color: #e74c3c;
        }

        .pending-item.appeal-item {
            border-left-color: #f39c12;
        }

        .pending-item strong {
            color: #2c5aa0;
            font-size: 1.1rem;
        }

        .pending-item small {
            color: #d35400;
        }

        .pending-item p {
            margin: 8px 0;
            color: #555;
        }

        .pending-item .meta {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
        }

        .pending-item .actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .pending-item button {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .pending-item button.danger {
            background-color: #e74c3c;
            color: white;
        }

        .pending-item button.success {
            background-color: #27ae60;
            color: white;
        }

        .pending-item button.warning {
            background-color: #f39c12;
            color: white;
        }

        .pending-item button.info {
            background-color: #3498db;
            color: white;
        }

        .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 8px;
        }

        .status-pending {
            background-color: #f39c12;
            color: white;
        }

        .status-rejected {
            background-color: #e74c3c;
            color: white;
        }

        .status-appeal {
            background-color: #9b59b6;
            color: white;
        }

        .pending-item.highlighted {
            animation: highlight-pulse 2s infinite;
            border: 2px solid #2c5aa0;
        }

        @keyframes highlight-pulse {
            0% { box-shadow: 0 0 0 0 rgba(44, 90, 160, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(44, 90, 160, 0); }
            100% { box-shadow: 0 0 0 0 rgba(44, 90, 160, 0); }
        }

        /* 新增：徽章通知 */
        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .notification-badge {
            position: relative;
        }

        /* 新增：我的投稿状态面板 - 轮播样式 */
        .my-submissions-panel {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            position: relative;
            overflow: hidden;
        }

        .my-submissions-title {
            font-size: 1.1rem;
            color: #2c5aa0;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .carousel-container {
            position: relative;
            width: 100%;
            height: 230px; /* 修改：从200px增加到230px */
            overflow: hidden;
        }

        .carousel-track {
            display: flex;
            transition: transform 0.5s ease;
            height: 100%;
        }

        .carousel-slide {
            flex: 0 0 100%;
            padding: 10px;
            box-sizing: border-box;
        }

        .carousel-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(44, 90, 160, 0.7);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: background-color 0.3s;
        }

        .carousel-arrow:hover {
            background-color: rgba(44, 90, 160, 0.9);
        }

        .carousel-arrow.left {
            left: 5px;
        }

        .carousel-arrow.right {
            right: 5px;
        }

        .carousel-dots {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 10px;
        }

        .carousel-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #ccc;
            border: none;
            cursor: pointer;
            padding: 0;
        }

        .carousel-dot.active {
            background-color: #2c5aa0;
        }

        .submission-item {
            padding: 15px;
            border-radius: 6px;
            background-color: white;
            border-left: 4px solid #3498db;
            height: 210px; /* 修改：从180px增加到210px */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .submission-item.rejected {
            border-left-color: #e74c3c;
        }

        .submission-item.pending {
            border-left-color: #f39c12;
        }

        .submission-item.approved {
            border-left-color: #27ae60;
        }

        .submission-item .word {
            font-weight: bold;
            color: #2c5aa0;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .submission-item .pronunciation {
            color: #d35400;
            font-size: 0.85rem;
            margin-bottom: 8px;
        }

        .submission-item .status {
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-bottom: 5px;
            align-self: flex-start;
        }

        .status-pending-badge {
            background-color: #f39c12;
            color: white;
        }

        .status-rejected-badge {
            background-color: #e74c3c;
            color: white;
        }

        .status-approved-badge {
            background-color: #27ae60;
            color: white;
        }

        .submission-item .meta {
            font-size: 0.7rem;
            color: #666;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .submission-item .actions {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin-top: auto;
        }

        .submission-item button {
            padding: 4px 8px;
            font-size: 0.7rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .edit-submission-btn {
            background-color: #3498db;
            color: white;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .edit-submission-btn:hover {
            background-color: #2980b9;
        }

        .delete-submission-btn {
            background-color: #e74c3c;
            color: white;
        }

        .delete-submission-btn:hover {
            background-color: #c0392b;
        }

        .resubmit-btn {
            background-color: #f39c12;
            color: white;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .resubmit-btn:hover {
            background-color: #d68910;
        }

        .appeal-btn {
            background-color: #9b59b6;
            color: white;
        }

        .appeal-btn:hover {
            background-color: #8e44ad;
        }

        .view-word-btn {
            background-color: #2c5aa0;
            color: white;
        }

        .view-word-btn:hover {
            background-color: #1e3d73;
        }

        /* 修正按钮样式 */
        .correction-link {
            color: #2c5aa0;
            text-decoration: none;
            font-size: 0.9rem;
            margin-left: 10px;
            padding: 4px 8px;
            border: 1px solid #2c5aa0;
            border-radius: 4px;
            background-color: #f0f4ff;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            transition: all 0.3s;
        }
        
        .correction-link:hover {
            background-color: #2c5aa0;
            color: white;
        }

        /* 留言板样式 */
        .comments-section {
            margin-top: 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .comments-title {
            font-size: 1.1rem;
            color: #2c5aa0;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .comments-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 10px;
            background-color: white;
            border-radius: 6px;
            position: relative;
        }

        .comment-item {
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            background-color: #f9f9f9;
            border-left: 4px solid #3498db;
            position: relative;
            min-height: 100px;
        }

        .comment-item.admin-comment {
            border-left-color: #2c5aa0;
        }

        .comment-header {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }

        .comment-author {
            font-weight: bold;
            color: #2c5aa0;
            display: flex;
            align-items: center;
            font-size: 0.95rem;
        }

        /* 留言时间移到用户名下方 */
        .comment-time-container {
            font-size: 0.8rem;
            color: #777;
            margin-top: 3px;
            margin-bottom: 8px;
        }

        .comment-content {
            color: #333;
            line-height: 1.5;
            font-size: 0.9rem;
            padding: 5px 0;
            word-wrap: break-word;
        }

        .comment-actions {
            position: absolute;
            right: 10px;
            top: 10px;
            display: flex;
            gap: 5px;
        }

        .pin-comment-btn {
            cursor: pointer;
            font-size: 14px;
            padding: 2px 5px;
            border-radius: 3px;
            transition: all 0.3s;
            color: #f39c12;
            background: none;
            border: none;
        }

        .pin-comment-btn:hover {
            background-color: rgba(243, 156, 18, 0.1);
        }

        .pin-comment-btn.pinned {
            color: #27ae60;
        }

        .delete-comment-btn {
            cursor: pointer;
            font-size: 14px;
            padding: 2px 5px;
            border-radius: 3px;
            transition: all 0.3s;
            color: #e74c3c;
            background: none;
            border: none;
        }

        .delete-comment-btn:hover {
            background-color: rgba(231, 76, 60, 0.1);
        }

        /* 新增：置顶留言样式 */
        .comment-item.pinned-comment {
            border-left-color: #f39c12;
            background-color: #fff8e1;
        }

        .crown-icon {
            color: #f39c12;
            margin-right: 5px;
            font-size: 14px;
        }

        .new-comment-form {
            margin-top: 15px;
            display: none; /* 默认隐藏，管理员输入密码后才显示 */
        }

        .comment-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .comment-submit-btn {
            background-color: #2c5aa0;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }

        /* 新增：一键清空按钮样式 */
        .clear-all-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
            margin-left: 10px;
        }

        .clear-all-btn:hover {
            background-color: #c0392b;
        }

        /* 新增：使用说明折叠面板 */
        .instructions-collapsible {
            margin-top: 20px;
        }

        .instructions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: #f0f4ff;
            border-radius: 8px;
            cursor: pointer;
            border: 1px solid #ddd;
        }

        .instructions-header h3 {
            margin: 0;
            color: #2c5aa0;
            font-size: 1rem;
        }

        .instructions-content {
            padding: 15px;
            background-color: white;
            border-radius: 0 0 8px 8px;
            border: 1px solid #ddd;
            border-top: none;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .instructions-content p {
            margin-bottom: 10px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .instructions-content strong {
            color: #2c5aa0;
        }

        .instructions-toggle-icon {
            transition: transform 0.3s;
        }

        .instructions-toggle-icon.expanded {
            transform: rotate(180deg);
        }

        /* 新增：滚动条样式 */
        .comments-list::-webkit-scrollbar {
            width: 8px;
        }

        .comments-list::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 4px;
        }

        .comments-list::-webkit-scrollbar-thumb {
            background: rgba(44, 90, 160, 0.3);
            border-radius: 4px;
            transition: all 0.3s;
        }

        .comments-list::-webkit-scrollbar-thumb:hover {
            background: rgba(44, 90, 160, 0.5);
        }

        /* 新增：按钮组样式 */
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .button-group .edit-toggle-btn {
            flex: 1;
            margin: 0;
        }

        /* 新增：留言管理按钮样式 */
        .comment-manage-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }

        .comment-manage-btn:hover {
            background-color: #2980b9;
        }

        /* 新增：留言外部提交按钮样式 */
        .external-comment-btn {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
            text-decoration: none;
        }

        .external-comment-btn:hover {
            background-color: #219653;
        }

        /* 新增：留言搜索按钮样式 */
        .comment-search-btn {
            background-color: #f39c12;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }

        .comment-search-btn:hover {
            background-color: #d68910;
        }

        /* 新增：留言搜索框样式 */
        .comment-search-box {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }

        .comment-search-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .comment-search-clear {
            background-color: #95a5a6;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .comment-search-clear:hover {
            background-color: #7f8c8d;
        }

        /* 新增：留言管理按钮容器 */
        .comment-buttons-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .comment-admin-row {
            display: flex;
            gap: 10px;
            width: 100%;
        }

        .comment-user-row {
            display: flex;
            gap: 10px;
            width: 100%;
        }

        .comment-btn {
            flex: 1;
            min-width: 120px;
        }

        /* 数据刷新按钮样式 */
        .data-refresh-panel {
            margin-top: 20px;
            padding: 15px;
            background: #f0f4ff;
            border-radius: 8px;
            text-align: center;
        }

        .refresh-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .refresh-btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        .refresh-btn:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }

        .last-update-time {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }

            h1 {
                font-size: 2.2rem;
            }

            .admin-panel {
                flex-direction: column;
            }
            
            .carousel-container {
                height: 250px; /* 修改：从220px增加到250px */
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .comment-buttons-container {
                flex-direction: column;
            }
            
            .comment-admin-row, .comment-user-row {
                flex-direction: column;
            }
            
            .comment-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-book"></i> 潮州话在线字典</h1>
            <p class="subtitle">探索潮汕方言的丰富词汇与文化内涵</p>
        </header>

        <div class="main-content">
            <section class="search-section">
                <h2 class="section-title">搜索词汇</h2>
                <div class="search-box">
                    <input type="text" id="search-input" placeholder="输入潮州话词汇或拼音进行搜索...">
                    <button class="search-btn" id="search-btn">
                        <i class="fas fa-search"></i>
                    </button>
                </div>

                <!-- 数据刷新面板 -->
                <div class="data-refresh-panel">
                    <button id="refresh-data-btn" class="refresh-btn">
                        <i class="fas fa-sync-alt"></i> 刷新数据
                    </button>
                    <p class="last-update-time">
                        最后更新: <span id="last-update-time">正在加载...</span>
                    </p>
                </div>

                <div class="fuzzy-results" id="fuzzy-results" style="display: none;">
                    <div class="fuzzy-title">模糊音匹配结果</div>
                    <div id="fuzzy-list"></div>
                </div>

                <div class="recent-searches">
                    <div class="recent-title">近期搜索</div>
                    <div class="recent-tags" id="recent-tags"></div>
                </div>

                <!-- 我的投稿状态轮播 -->
                <div class="my-submissions-panel">
                    <div class="my-submissions-title">
                        <span><i class="fas fa-user-check"></i> 我的投稿状态</span>
                        <span id="my-submissions-count" class="badge" style="display: none;">0</span>
                    </div>
                    
                    <div class="carousel-container">
                        <button class="carousel-arrow left" id="carousel-prev">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        
                        <div class="carousel-track" id="carousel-track">
                            <!-- 轮播内容动态加载 -->
                        </div>
                        
                        <button class="carousel-arrow right" id="carousel-next">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    
                    <div class="carousel-dots" id="carousel-dots">
                        <!-- 轮播点动态加载 -->
                    </div>
                </div>

                <!-- 折叠式使用说明 -->
                <div class="instructions-collapsible">
                    <div class="instructions-header" id="instructions-toggle">
                        <h3><i class="fas fa-info-circle"></i> 使用说明</h3>
                        <i class="fas fa-chevron-down instructions-toggle-icon"></i>
                    </div>
                    <div class="instructions-content" id="instructions-content">
                        <p>1. 输入潮州话词汇或拼音进行查询</p>
                        <p>2. 点击右侧词汇可查看详细释义</p>
                        <p>3. 点击发音按钮可跳转到喜马拉雅发音链接</p>
                        <p>4. 点击图片按钮可查看相关图片（如有）</p>
                        <p>5. 点击近期搜索标签可快速查询</p>
                        <p>6. 支持模糊音检索，输入拼音可匹配相似发音词汇</p>
                        <p>7. <strong>任何人都可以提交新词条，审核后发布</strong></p>
                        <p>8. 已发布词条的<strong>修正需要管理员密码</strong></p>
                        <p>9. 可在"我的投稿状态"中查看和管理您的投稿</p>
                        <p>10. 可以在留言区参与讨论</p>
                    </div>
                </div>

                <div class="edit-section">
                    <h3 class="section-title">词条管理</h3>

                    <div class="admin-panel">
                        <button class="admin-btn notification-badge" id="toggle-recycle-bin">
                            <i class="fas fa-trash-alt"></i> 管理回收站
                            <span id="recycle-badge" class="badge" style="display: none;">0</span>
                        </button>
                        <button class="admin-btn notification-badge" id="toggle-review-panel">
                            <i class="fas fa-clipboard-check"></i> 审核新词条
                            <span id="review-badge" class="badge" style="display: none;">0</span>
                        </button>
                    </div>

                    <!-- 按钮组：数据管理和导入Excel -->
                    <div class="button-group">
                        <button class="edit-toggle-btn" id="data-manage-btn">
                            <i class="fas fa-database"></i> 数据管理
                        </button>
                        <button class="edit-toggle-btn" id="import-excel-btn">
                            <i class="fas fa-file-import"></i> 导入Excel
                        </button>
                    </div>

                    <!-- 留言板 -->
                    <div class="comments-section">
                        <div class="comments-title">
                            <span><i class="fas fa-comments"></i> 留言讨论区</span>
                        </div>
                        
                        <!-- 留言管理按钮容器 -->
                        <div class="comment-buttons-container">
                            <div class="comment-admin-row">
                                <button class="comment-manage-btn comment-btn" id="comment-manage-btn">
                                    <i class="fas fa-cog"></i> 留言管理
                                </button>
                                <button class="comment-manage-btn comment-btn" id="comment-import-btn">
                                    <i class="fas fa-file-import"></i> 数据导入
                                </button>
                            </div>
                            <div class="comment-user-row">
                                <button class="comment-search-btn comment-btn" id="comment-search-btn">
                                    <i class="fas fa-search"></i> 内容检索
                                </button>
                                <a href="https://www.wjx.top/vm/r5XA9au.aspx#" target="_blank" class="external-comment-btn comment-btn">
                                    <i class="fas fa-comment"></i> 发表留言
                                </a>
                            </div>
                        </div>
                        
                        <!-- 内容检索面板 -->
                        <div class="comment-search-box" id="comment-search-box" style="display: none;">
                            <input type="text" class="comment-search-input" id="comment-search-input" placeholder="输入用户名或留言内容关键词...">
                            <button class="comment-search-btn" id="comment-search-execute-btn">搜索</button>
                            <button class="comment-search-clear" id="comment-search-clear-btn">清除</button>
                        </div>
                        
                        <div class="comments-list" id="comments-list">
                            <!-- 留言内容动态加载 -->
                        </div>
                        
                        <div class="new-comment-form" id="new-comment-form">
                            <input type="text" class="comment-input" id="comment-author" placeholder="您的称呼（可选）">
                            <textarea class="comment-input" id="comment-content" placeholder="请输入留言内容..." rows="3"></textarea>
                            <button class="comment-submit-btn" id="comment-submit-btn">提交留言</button>
                        </div>
                    </div>

                    <div id="recycle-panel" class="admin-panel-container">
                        <h4>回收站与申诉管理 
                            <button class="close-panel" onclick="document.getElementById('recycle-panel').style.display='none'">&times;</button>
                            <button class="clear-all-btn" onclick="clearAllRecycleBin()" title="清空回收站（仅保留测试词条）">
                                <i class="fas fa-trash"></i> 清空回收站
                            </button>
                        </h4>
                        <div class="pending-list" id="recycle-list"></div>
                    </div>

                    <div id="review-panel" class="admin-panel-container">
                        <h4>待审核词条 <button class="close-panel" onclick="document.getElementById('review-panel').style.display='none'">&times;</button></h4>
                        <div class="pending-list" id="review-list"></div>
                    </div>

                    <div id="password-prompt" class="password-prompt" style="display: none;">
                        <p>请输入管理员密码以修正已发布的词条：</p>
                        <input type="password" class="password-input" id="password-input" placeholder="输入密码..." autocomplete="off">
                        <button class="password-btn" id="password-btn">验证密码</button>
                        <div id="password-error" class="error-message" style="display: none;">密码错误，请重新输入</div>
                    </div>

                    <div id="edit-form-container" class="edit-form" style="display: none;">
                        <div id="current-edit-title" class="current-edit-title"></div>
                        <div id="edit-form"></div>
                        <div class="form-actions">
                            <button class="form-btn submit-btn" id="submit-btn">提交词条</button>
                            <button class="form-btn cancel-btn" id="cancel-btn">取消</button>
                        </div>
                        <button class="delete-word-btn" id="delete-word-btn" style="display: none;">移入回收站</button>
                    </div>
                </div>
            </section>

            <section class="results-section">
                <h2 class="section-title">词条解释</h2>
                <div id="results-container"></div>
            </section>
        </div>

        <footer>
            <p>潮州话在线字典 &copy; 2025 | 本字典收录潮汕方言词汇，旨在保护和传承潮汕语言文化</p>
            <p>数据来源：潮汕方言研究资料 | 设计制作：许晓聪</p>
        </footer>
    </div>

    <script>
        // ==================== 核心数据与配置 ====================
        let dictionaryData = [];
        let pendingWords = [];
        let recycleBin = [];
        let comments = [];
        let recentSearches = ["孰及"];
        const ADMIN_PASSWORD = "2025";
        let currentEditIndex = -1;
        let currentEditMode = 'user_submit';
        let currentEditOriginalWord = '';
        let highlightedPendingIndex = -1;
        
        // 轮播相关变量
        let currentSlideIndex = 0;
        let carouselItems = [];
        
        // 留言搜索相关变量
        let commentSearchActive = false;
        let commentSearchResults = [];

        // ==================== DOM 元素 ====================
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const recentTagsContainer = document.getElementById('recent-tags');
        const resultsContainer = document.getElementById('results-container');
        const fuzzyResultsContainer = document.getElementById('fuzzy-results');
        const fuzzyListContainer = document.getElementById('fuzzy-list');
        const dataManageBtn = document.getElementById('data-manage-btn');
        const importExcelBtn = document.getElementById('import-excel-btn');
        const passwordPrompt = document.getElementById('password-prompt');
        const passwordInput = document.getElementById('password-input');
        const passwordBtn = document.getElementById('password-btn');
        const passwordError = document.getElementById('password-error');
        const editFormContainer = document.getElementById('edit-form-container');
        const editForm = document.getElementById('edit-form');
        const currentEditTitle = document.getElementById('current-edit-title');
        const submitBtn = document.getElementById('submit-btn');
        const cancelBtn = document.getElementById('cancel-btn');
        const deleteWordBtn = document.getElementById('delete-word-btn');
        const refreshDataBtn = document.getElementById('refresh-data-btn');
        const lastUpdateTimeElement = document.getElementById('last-update-time');
        
        // 徽章元素
        const reviewBadge = document.getElementById('review-badge');
        const recycleBadge = document.getElementById('recycle-badge');
        const mySubmissionsCountBadge = document.getElementById('my-submissions-count');
        
        // 轮播元素
        const carouselTrack = document.getElementById('carousel-track');
        const carouselPrev = document.getElementById('carousel-prev');
        const carouselNext = document.getElementById('carousel-next');
        const carouselDots = document.getElementById('carousel-dots');
        
        // 留言板元素
        const commentsList = document.getElementById('comments-list');
        const commentAuthorInput = document.getElementById('comment-author');
        const commentContentInput = document.getElementById('comment-content');
        const commentSubmitBtn = document.getElementById('comment-submit-btn');
        const newCommentForm = document.getElementById('new-comment-form');
        const commentManageBtn = document.getElementById('comment-manage-btn');
        const commentImportBtn = document.getElementById('comment-import-btn');
        const commentSearchBtn = document.getElementById('comment-search-btn');
        const commentSearchBox = document.getElementById('comment-search-box');
        const commentSearchInput = document.getElementById('comment-search-input');
        const commentSearchExecuteBtn = document.getElementById('comment-search-execute-btn');
        const commentSearchClearBtn = document.getElementById('comment-search-clear-btn');

        // ==================== 数据加载函数 ====================
        async function loadDataFromJson() {
            try {
                console.log("正在从 data.json 加载数据...");
                // 添加时间戳防止缓存
                const response = await fetch('data.json?v=' + new Date().getTime());
                
                if (!response.ok) {
                    throw new Error(`HTTP错误! 状态: ${response.status}`);
                }
                
                const jsonData = await response.json();
                console.log("成功加载 data.json 数据:", jsonData);
                
                // 解析数据
                dictionaryData = jsonData.dictionaryData || jsonData || [];
                pendingWords = jsonData.pendingWords || [];
                recycleBin = jsonData.recycleBin || [];
                comments = jsonData.comments || [];
                recentSearches = jsonData.recentSearches || ["孰及"];
                
                // 验证数据完整性
                if (!Array.isArray(dictionaryData)) {
                    console.warn("dictionaryData 不是数组，尝试转换...");
                    dictionaryData = Object.values(dictionaryData);
                }
                
                // 更新最后更新时间显示
                updateLastUpdateTime();
                
                return true;
                
            } catch (error) {
                console.error("加载 data.json 失败:", error);
                showError("无法加载 data.json 文件，请确保文件存在且格式正确");
                return false;
            }
        }

        // 更新最后更新时间显示
        function updateLastUpdateTime() {
            if (lastUpdateTimeElement && dictionaryData.length > 0) {
                // 找到最新的修改时间
                let latestDate = '';
                dictionaryData.forEach(item => {
                    if (item.lastModified && (!latestDate || item.lastModified > latestDate)) {
                        latestDate = item.lastModified;
                    }
                });
                
                pendingWords.forEach(item => {
                    if (item.lastModified && (!latestDate || item.lastModified > latestDate)) {
                        latestDate = item.lastModified;
                    }
                });
                
                if (latestDate) {
                    lastUpdateTimeElement.textContent = latestDate;
                    lastUpdateTimeElement.style.color = '#27ae60';
                } else {
                    lastUpdateTimeElement.textContent = '未知';
                    lastUpdateTimeElement.style.color = '#666';
                }
            }
        }

        // 显示错误提示
        function showError(message) {
            if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
                setTimeout(() => {
                    const errorMsg = document.createElement('div');
                    errorMsg.style.cssText = 'position:fixed; top:20px; right:20px; background:#e74c3c; color:white; padding:15px; border-radius:8px; z-index:9999; max-width:300px; box-shadow:0 4px 12px rgba(0,0,0,0.2);';
                    errorMsg.innerHTML = `
                        <strong><i class="fas fa-exclamation-triangle"></i> 数据加载失败</strong>
                        <p style="margin:8px 0; font-size:14px;">${message}</p>
                        <button onclick="this.parentElement.remove()" style="background:white; color:#e74c3c; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">关闭</button>
                    `;
                    document.body.appendChild(errorMsg);
                }, 1000);
            }
        }

        // 重新加载数据
        async function reloadData() {
            refreshDataBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 刷新中...';
            refreshDataBtn.disabled = true;
            
            const success = await loadDataFromJson();
            
            if (success) {
                // 刷新页面显示
                displayRecentSearches();
                if (dictionaryData.length > 0) {
                    displayWord(dictionaryData[0]);
                } else {
                    displayNoResults(true);
                }
                
                // 刷新轮播和留言
                loadMySubmissionsCarousel();
                loadComments();
                
                // 更新徽章
                updateAllBadges();
                
                refreshDataBtn.innerHTML = '<i class="fas fa-check"></i> 刷新成功';
                setTimeout(() => {
                    refreshDataBtn.innerHTML = '<i class="fas fa-sync-alt"></i> 刷新数据';
                    refreshDataBtn.disabled = false;
                }, 1500);
                
                return true;
            } else {
                refreshDataBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> 刷新失败';
                setTimeout(() => {
                    refreshDataBtn.innerHTML = '<i class="fas fa-sync-alt"></i> 刷新数据';
                    refreshDataBtn.disabled = false;
                }, 3000);
                return false;
            }
        }

        // ==================== 页面初始化 ====================
        document.addEventListener('DOMContentLoaded', async function () {
            // 显示加载状态
            resultsContainer.innerHTML = `
                <div class="no-results">
                    <i class="fas fa-spinner fa-spin" style="font-size: 3rem; margin-bottom: 20px; color: #2c5aa0;"></i>
                    <h3>正在加载数据...</h3>
                    <p>正在从 data.json 文件读取最新数据</p>
                </div>`;
            
            // 加载数据
            await loadDataFromJson();
            
            // 初始化页面
            displayRecentSearches();
            if (dictionaryData.length > 0) {
                displayWord(dictionaryData[0]);
            } else {
                displayNoResults(true);
            }
            setupEventListeners();
            
            // 初始化徽章通知
            updateAllBadges();
            
            // 加载用户投稿状态轮播
            loadMySubmissionsCarousel();
            
            // 加载留言板
            loadComments();
            
            // 初始化使用说明折叠面板
            initInstructionsPanel();
        });

        // ==================== 初始化使用说明面板 ====================
        function initInstructionsPanel() {
            const toggleBtn = document.getElementById('instructions-toggle');
            const content = document.getElementById('instructions-content');
            const icon = toggleBtn.querySelector('.instructions-toggle-icon');
            
            if (toggleBtn && content && icon) {
                toggleBtn.addEventListener('click', function() {
                    if (content.style.display === 'block') {
                        content.style.display = 'none';
                        icon.classList.remove('expanded');
                    } else {
                        content.style.display = 'block';
                        icon.classList.add('expanded');
                    }
                });
            }
        }

        // ==================== 事件监听器设置 ====================
        function setupEventListeners() {
            searchBtn.addEventListener('click', () => performSearch(searchInput.value));
            searchInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') performSearch(searchInput.value); });
            searchInput.addEventListener('input', handleSearchInput);
            
            // 数据刷新按钮
            refreshDataBtn.addEventListener('click', reloadData);
            
            // 数据管理按钮 - 需要管理员密码
            dataManageBtn.addEventListener('click', () => {
                const password = prompt('请输入管理员密码以使用数据管理功能：');
                if (password === ADMIN_PASSWORD) {
                    startUserSubmit();
                } else {
                    alert('密码错误！');
                }
            });
            
            // 导入Excel按钮 - 需要管理员密码
            importExcelBtn.addEventListener('click', importExcelData);
            
            passwordBtn.addEventListener('click', verifyPassword);
            passwordInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    verifyPassword();
                }
            });
            
            submitBtn.addEventListener('click', saveWord);
            cancelBtn.addEventListener('click', cancelEdit);
            deleteWordBtn.addEventListener('click', deleteCurrentWord);
            
            document.getElementById('toggle-recycle-bin').addEventListener('click', toggleRecycleBin);
            document.getElementById('toggle-review-panel').addEventListener('click', toggleReviewPanel);
            
            // 轮播事件
            carouselPrev.addEventListener('click', () => moveCarousel(-1));
            carouselNext.addEventListener('click', () => moveCarousel(1));
            
            // 留言板事件
            commentSubmitBtn.addEventListener('click', submitComment);
            commentContentInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && e.ctrlKey) {
                    submitComment();
                }
            });
            
            // 留言管理按钮事件
            commentManageBtn.addEventListener('click', () => {
                const password = prompt('请输入管理员密码以使用留言管理功能：');
                if (password === ADMIN_PASSWORD) {
                    newCommentForm.style.display = newCommentForm.style.display === 'block' ? 'none' : 'block';
                } else {
                    alert('密码错误！');
                }
            });
            
            // 留言数据导入按钮事件
            commentImportBtn.addEventListener('click', () => {
                const password = prompt('请输入管理员密码以导入留言数据：');
                if (password === ADMIN_PASSWORD) {
                    importCommentsExcelData();
                } else {
                    alert('密码错误！');
                }
            });
            
            // 内容检索按钮事件
            commentSearchBtn.addEventListener('click', () => {
                commentSearchBox.style.display = commentSearchBox.style.display === 'flex' ? 'none' : 'flex';
                if (commentSearchBox.style.display === 'flex') {
                    commentSearchInput.focus();
                }
            });
            
            // 内容检索执行按钮事件
            commentSearchExecuteBtn.addEventListener('click', executeCommentSearch);
            
            // 内容检索输入框回车事件
            commentSearchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    executeCommentSearch();
                }
            });
            
            // 内容检索清除按钮事件
            commentSearchClearBtn.addEventListener('click', clearCommentSearch);
        }

        // ==================== 搜索功能 ====================
        function performSearch(query) {
            searchWord(query);
            searchInput.blur();
        }

        function searchWord(query) {
            const normalizedQuery = query.trim().toLowerCase();
            if (!normalizedQuery) return;

            const matchedWord = dictionaryData.find(item =>
                item.word.toLowerCase() === normalizedQuery ||
                item.pronunciation.toLowerCase().includes(normalizedQuery) ||
                item.word.includes(normalizedQuery)
            );

            if (matchedWord) {
                if (!recentSearches.includes(matchedWord.word)) {
                    recentSearches.unshift(matchedWord.word);
                    if (recentSearches.length > 5) recentSearches.pop();
                    displayRecentSearches();
                }
                displayWord(matchedWord);
                fuzzyResultsContainer.style.display = 'none';
            } else {
                displayNoResults(false, query);
            }
        }

        function displayNoResults(isEmptyDictionary = false, searchQuery = '') {
            resultsContainer.innerHTML = `
                <div class="no-results">
                    <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 20px; color: #ccc;"></i>
                    <h3>${isEmptyDictionary ? '字典暂无词条' : '未找到相关词条'}</h3>
                    <p>${isEmptyDictionary ? '字典中暂无词条，欢迎您成为第一位贡献者！' : `未找到与"${searchQuery}"相关的潮州话词条，请尝试其他词汇。`}</p>
                    <a href="https://v.wjx.cn/vm/OZYCfnN.aspx#" target="_blank" class="quick-submit-btn" style="text-decoration: none; display: inline-flex;">
                        <i class="fas fa-plus-circle"></i> 在线提交"${searchQuery || '新'}"词条
                    </a>
                    <p style="margin-top: 15px; font-size: 0.9rem; color: #666;">您提交的词条将在管理员审核后发布到字典中。</p>
                </div>`;
        }

        function handleSearchInput() {
            const query = searchInput.value.trim();
            if (query.length >= 1) {
                performFuzzySearch(query);
            } else {
                fuzzyResultsContainer.style.display = 'none';
            }
        }

        function performFuzzySearch(query) {
            const normalizedQuery = query.trim().toLowerCase();
            if (!normalizedQuery) {
                fuzzyResultsContainer.style.display = 'none';
                return;
            }

            const fuzzyMatches = dictionaryData.filter(item => {
                const cleanPronunciation = item.pronunciation.replace(/[0-9]/g, '').toLowerCase();
                const cleanQuery = normalizedQuery.replace(/[0-9]/g, '');
                return (
                    cleanPronunciation.includes(cleanQuery) ||
                    item.word.toLowerCase().includes(normalizedQuery) ||
                    item.pronunciation.toLowerCase().includes(normalizedQuery)
                );
            });

            if (fuzzyMatches.length > 0) {
                displayFuzzyResults(fuzzyMatches);
                fuzzyResultsContainer.style.display = 'block';
            } else {
                fuzzyResultsContainer.style.display = 'none';
            }
        }

        function displayFuzzyResults(matches) {
            fuzzyListContainer.innerHTML = '';
            matches.forEach(wordData => {
                const item = document.createElement('div');
                item.className = 'fuzzy-item';
                item.innerHTML = `<div class="fuzzy-word">${wordData.word}</div><div class="fuzzy-pronunciation">${wordData.pronunciation}</div>`;
                item.addEventListener('click', () => {
                    searchInput.value = wordData.word;
                    performSearch(wordData.word);
                });
                fuzzyListContainer.appendChild(item);
            });
        }

        function displayRecentSearches() {
            recentTagsContainer.innerHTML = '';
            recentSearches.forEach(word => {
                const tag = document.createElement('div');
                tag.className = 'recent-tag';
                tag.textContent = word;
                tag.addEventListener('click', () => {
                    searchInput.value = word;
                    performSearch(word);
                });
                recentTagsContainer.appendChild(tag);
            });
        }

        // ==================== 词条展示 ====================
        function displayWord(wordData) {
            let examplesHTML = '';
            wordData.examples.forEach(example => {
                examplesHTML += `
                    <div class="example">
                        <div class="example-text">${example.text}</div>
                        <div class="pronunciation">${example.pronunciation}</div>
                        <div class="example-translation">${example.translation}</div>
                    </div>`;
            });

            let relatedLanguagesHTML = '';
            wordData.relatedLanguages.forEach(lang => {
                relatedLanguagesHTML += `
                    <div class="language-item">
                        <span class="language-name">${lang.language}：</span>
                        ${lang.text ? `<span>${lang.text}</span>` : ''}
                        ${lang.pronunciation ? `<div class="pronunciation">${lang.pronunciation}</div>` : ''}
                        ${lang.translation ? `<div class="example-translation">${lang.translation}</div>` : ''}
                    </div>`;
            });

            const audioLink = wordData.audioLink || `https://www.ximalaya.com/search/${encodeURIComponent(wordData.word)}`;
            const imageLink = wordData.imageLink || '';
            const wordIndex = dictionaryData.findIndex(item => item.word === wordData.word);
            const showAdminEdit = wordIndex >= 0;

            const imageButtonHTML = imageLink ? 
                `<a href="${imageLink}" target="_blank" class="view-image-btn" title="查看相关图片">
                    <i class="fas fa-image"></i>
                </a>` : 
                `<button class="view-image-btn disabled" title="暂无相关图片" disabled>
                    <i class="fas fa-image"></i>
                </button>`;

            resultsContainer.innerHTML = `
                <div class="word-card">
                    <div class="word-header">
                        <div>
                            <div class="word-title">${wordData.word}</div>
                            <div class="pronunciation">${wordData.pronunciation}</div>
                            <div style="margin-top: 5px; font-size: 0.9rem; color: #777;">
                                最后更新：${wordData.lastModified || '未知'} | 提交者：${wordData.submittedBy || '匿名用户'}
                                ${showAdminEdit ? ` | <a href="javascript:void(0)" class="correction-link" onclick="startCorrection(${wordIndex})">
                                    <i class="fas fa-edit"></i> 修正
                                </a>` : ''}
                            </div>
                        </div>
                        <div class="audio-image-container">
                            ${imageButtonHTML}
                            <a href="${audioLink}" target="_blank" class="play-audio" title="点击跳转到喜马拉雅发音页面">
                                <i class="fas fa-volume-up"></i>
                            </a>
                        </div>
                    </div>
                    <div class="word-info">
                        <div class="info-box"><div class="info-label">出处</div><div class="info-content">${wordData.source}</div></div>
                        <div class="info-box"><div class="info-label">原文</div><div class="info-content">${wordData.originalText || "暂无原文"}</div></div>
                        <div class="info-box"><div class="info-label">语法</div><div class="info-content">${wordData.grammar}</div></div>
                    </div>
                    <div class="info-box"><div class="info-label">归纳</div><div class="info-content">${wordData.summary}</div></div>
                    <div class="info-box"><div class="info-label">例句</div>${examplesHTML}</div>
                    ${wordData.idiom && wordData.idiom.text ? `
                    <div class="info-box">
                        <div class="info-label">俗语/成语</div>
                        <div class="example">
                            <div class="example-text">${wordData.idiom.text}</div>
                            <div class="pronunciation">${wordData.idiom.pronunciation}</div>
                            <div class="example-translation">${wordData.idiom.translation}</div>
                        </div>
                    </div>` : ''}
                    ${wordData.notes ? `<div class="info-box"><div class="info-label">备注</div><div class="info-content">${wordData.notes}</div></div>` : ''}
                    ${wordData.relatedLanguages.length > 0 ? `
                    <div class="info-box">
                        <div class="info-label">相关语言对照</div>
                        <div class="related-languages">${relatedLanguagesHTML}</div>
                    </div>` : ''}
                    <div style="margin-top: 25px; padding-top: 15px; border-top: 1px dashed #eee; text-align: center;">
                        <p style="color: #666; margin-bottom: 10px;">没有找到您想查的词？</p>
                        <a href="https://v.wjx.cn/vm/OZYCfnN.aspx#" target="_blank" class="quick-submit-btn" style="text-decoration: none; display: inline-flex;">
                            <i class="fas fa-plus-circle"></i> 在线提交新词条
                        </a>
                    </div>
                </div>`;
        }

        // ==================== 修正功能 ====================
        function startCorrection(index) {
            passwordPrompt.style.display = 'block';
            passwordInput.focus();
            
            // 设置密码验证后的回调
            window.afterPasswordVerify = function() {
                currentEditMode = 'admin_correction';
                currentEditIndex = index;
                currentEditOriginalWord = dictionaryData[index].word;
                loadEditForm(index);
                editFormContainer.style.display = 'block';
                deleteWordBtn.style.display = 'none';
            };
        }

        function verifyPassword() {
            if (passwordInput.value === ADMIN_PASSWORD) {
                passwordPrompt.style.display = 'none';
                passwordInput.value = '';
                passwordError.style.display = 'none';
                
                if (window.afterPasswordVerify) {
                    window.afterPasswordVerify();
                    window.afterPasswordVerify = null;
                }
            } else {
                passwordError.style.display = 'block';
                passwordInput.value = '';
                passwordInput.focus();
            }
        }

        // ==================== 用户提交功能 ====================
        function startUserSubmit(prefilledWord = '') {
            currentEditMode = 'user_submit';
            currentEditIndex = -1;
            currentEditOriginalWord = '';
            loadEditForm();
            if (prefilledWord) {
                document.getElementById('edit-word').value = prefilledWord;
            }
            editFormContainer.style.display = 'block';
            passwordPrompt.style.display = 'none';
            deleteWordBtn.style.display = 'none';
            editFormContainer.scrollIntoView({ behavior: 'smooth' });
        }

        // ==================== 编辑功能 ====================
        function loadEditForm(editIndex = -1) {
            if (editIndex !== -1) {
                currentEditIndex = editIndex;
            }
            
            let wordData = {
                word: "", pronunciation: "", source: "", originalText: "", grammar: "", 
                audioLink: "", imageLink: "",
                examples: [], summary: "", idiom: { text: "", pronunciation: "", translation: "" },
                notes: "", relatedLanguages: [], submittedBy: ""
            };
            
            let formTitle = "提交新词条";
            let submitButtonText = "提交审核";

            if (currentEditMode === 'admin_correction' && currentEditIndex >= 0 && currentEditIndex < dictionaryData.length) {
                wordData = JSON.parse(JSON.stringify(dictionaryData[currentEditIndex]));
                formTitle = `修正词条：${wordData.word}`;
                submitButtonText = "提交修正（需重新审核）";
                deleteWordBtn.style.display = 'none';
            } else if (currentEditMode === 'admin_review' && currentEditIndex >= 0 && currentEditIndex < pendingWords.length) {
                wordData = JSON.parse(JSON.stringify(pendingWords[currentEditIndex]));
                formTitle = `编辑待审核词条：${wordData.word}`;
                submitButtonText = "保存修改";
                deleteWordBtn.style.display = 'none';
            } else {
                deleteWordBtn.style.display = 'none';
            }

            currentEditTitle.textContent = formTitle;
            submitBtn.textContent = submitButtonText;
            editForm.innerHTML = generateEditFormHTML(wordData);
        }

        function generateEditFormHTML(wordData) {
            return `
                <div class="form-group"><label class="form-label">词汇 *</label><input type="text" class="form-input" id="edit-word" value="${wordData.word}" required></div>
                <div class="form-group"><label class="form-label">拼音 *</label><input type="text" class="form-input" id="edit-pronunciation" value="${wordData.pronunciation}" required></div>
                <div class="form-group"><label class="form-label">出处</label><input type="text" class="form-input" id="edit-source" value="${wordData.source}"></div>
                <div class="form-group"><label class="form-label">原文</label><textarea class="form-textarea" id="edit-originalText">${wordData.originalText}</textarea></div>
                <div class="form-group"><label class="form-label">语法</label><textarea class="form-textarea" id="edit-grammar">${wordData.grammar}</textarea></div>
                <div class="form-group"><label class="form-label">喜马拉雅音频链接</label><input type="text" class="form-input" id="edit-audioLink" value="${wordData.audioLink}" placeholder="https://www.ximalaya.com/search/..."></div>
                <div class="form-group"><label class="form-label">相关图片链接</label><input type="text" class="form-input" id="edit-imageLink" value="${wordData.imageLink || ''}" placeholder="https://example.com/image.jpg"></div>
                <div class="form-group"><label class="form-label">例句</label><div id="edit-examples">${wordData.examples.map((example, index) => `
                    <div class="example-item" data-index="${index}">
                        <div class="form-group"><label class="form-label">例句 ${index + 1}</label><input type="text" class="form-input" value="${example.text}" id="edit-example-text-${index}"></div>
                        <div class="form-group"><label class="form-label">拼音</label><input type="text" class="form-input" value="${example.pronunciation}" id="edit-example-pronunciation-${index}"></div>
                        <div class="form-group"><label class="form-label">翻译</label><input type="text" class="form-input" value="${example.translation}" id="edit-example-translation-${index}"></div>
                        <button type="button" class="remove-example-btn" onclick="removeExample(${index})">删除例句</button>
                    </div>`).join('')}</div><button type="button" class="add-example-btn" onclick="addExample()">添加例句</button></div>
                <div class="form-group"><label class="form-label">归纳</label><textarea class="form-textarea" id="edit-summary">${wordData.summary}</textarea></div>
                <div class="form-group"><label class="form-label">俗语/成语</label>
                    <div class="form-group"><label class="form-label">俗语文本</label><input type="text" class="form-input" id="edit-idiom-text" value="${wordData.idiom.text || ''}"></div>
                    <div class="form-group"><label class="form-label">俗语拼音</label><input type="text" class="form-input" id="edit-idiom-pronunciation" value="${wordData.idiom.pronunciation || ''}"></div>
                    <div class="form-group"><label class="form-label">俗语翻译</label><input type="text" class="form-input" id="edit-idiom-translation" value="${wordData.idiom.translation || ''}"></div>
                </div>
                <div class="form-group"><label class="form-label">备注</label><textarea class="form-textarea" id="edit-notes">${wordData.notes}</textarea></div>
                ${currentEditMode === 'user_submit' || currentEditMode === 'admin_review' || currentEditMode === 'admin_correction' ? `<div class="form-group"><label class="form-label">您的称呼（可选，留空则显示"匿名用户"）</label><input type="text" class="form-input" id="edit-submittedBy" value="${wordData.submittedBy || ''}" placeholder="匿名用户"></div>` : ''}
                <div class="form-group"><label class="form-label">相关语言对照（每行格式：语言|原文|拼音|翻译）</label>
                    <textarea class="form-textarea" id="edit-relatedLanguages" placeholder="例如：日语|君のことが好きです。|kimi no koto ga suki desu.|我喜欢你">${wordData.relatedLanguages.map(lang =>
                        `${lang.language}|${lang.text || ''}|${lang.pronunciation || ''}|${lang.translation || ''}`
                    ).join('\n')}</textarea>
                </div>`;
        }

        function addExample() {
            const examplesContainer = document.getElementById('edit-examples');
            const exampleCount = examplesContainer.children.length;
            const exampleHtml = `
                <div class="example-item" data-index="${exampleCount}">
                    <div class="form-group"><label class="form-label">例句 ${exampleCount + 1}</label><input type="text" class="form-input" id="edit-example-text-${exampleCount}"></div>
                    <div class="form-group"><label class="form-label">拼音</label><input type="text" class="form-input" id="edit-example-pronunciation-${exampleCount}"></div>
                    <div class="form-group"><label class="form-label">翻译</label><input type="text" class="form-input" id="edit-example-translation-${exampleCount}"></div>
                    <button type="button" class="remove-example-btn" onclick="removeExample(${exampleCount})">删除例句</button>
                </div>`;
            examplesContainer.insertAdjacentHTML('beforeend', exampleHtml);
        }

        function removeExample(index) {
            const exampleElement = document.querySelector(`.example-item[data-index="${index}"]`);
            if (exampleElement) {
                exampleElement.remove();
                const examples = document.querySelectorAll('.example-item');
                examples.forEach((example, newIndex) => {
                    example.setAttribute('data-index', newIndex);
                    const label = example.querySelector('.form-label');
                    if (label) label.textContent = `例句 ${newIndex + 1}`;
                    const inputs = example.querySelectorAll('input');
                    inputs.forEach(input => {
                        const oldId = input.id;
                        const newId = oldId.replace(/\d+$/, newIndex);
                        input.id = newId;
                    });
                    const removeBtn = example.querySelector('.remove-example-btn');
                    if (removeBtn) removeBtn.setAttribute('onclick', `removeExample(${newIndex})`);
                });
            }
        }

        // ==================== 词条保存功能 ====================
        function saveWord() {
            const word = document.getElementById('edit-word').value.trim();
            const pronunciation = document.getElementById('edit-pronunciation').value.trim();
            if (!word || !pronunciation) {
                alert('词汇和拼音是必填字段');
                return;
            }

            const source = document.getElementById('edit-source').value.trim();
            const originalText = document.getElementById('edit-originalText').value.trim();
            const grammar = document.getElementById('edit-grammar').value.trim();
            const audioLink = document.getElementById('edit-audioLink').value.trim();
            const imageLink = document.getElementById('edit-imageLink').value.trim();
            const summary = document.getElementById('edit-summary').value.trim();
            const idiomText = document.getElementById('edit-idiom-text').value.trim();
            const idiomPronunciation = document.getElementById('edit-idiom-pronunciation').value.trim();
            const idiomTranslation = document.getElementById('edit-idiom-translation').value.trim();
            const notes = document.getElementById('edit-notes').value.trim();
            
            // 获取提交者名称，修正时也可以修改提交者
            let submittedBy = '匿名用户';
            if (document.getElementById('edit-submittedBy')) {
                submittedBy = document.getElementById('edit-submittedBy').value.trim() || '匿名用户';
            }
            
            const relatedLanguagesText = document.getElementById('edit-relatedLanguages').value.trim();

            const examples = [];
            const exampleElements = document.querySelectorAll('.example-item');
            exampleElements.forEach((exampleElement) => {
                const index = exampleElement.getAttribute('data-index');
                const text = document.getElementById(`edit-example-text-${index}`).value.trim();
                const pronunciation = document.getElementById(`edit-example-pronunciation-${index}`).value.trim();
                const translation = document.getElementById(`edit-example-translation-${index}`).value.trim();
                if (text) examples.push({ text, pronunciation, translation });
            });

            const relatedLanguages = [];
            if (relatedLanguagesText) {
                relatedLanguagesText.split('\n').forEach(line => {
                    const parts = line.split('|').map(part => part.trim());
                    if (parts.length >= 1 && parts[0]) {
                        relatedLanguages.push({
                            language: parts[0],
                            text: parts[1] || '',
                            pronunciation: parts[2] || '',
                            translation: parts[3] || ''
                        });
                    }
                });
            }

            const currentDate = new Date().toISOString().split('T')[0];
            const wordData = {
                word, pronunciation, source, originalText, grammar,
                audioLink: audioLink || `https://www.ximalaya.com/search/${encodeURIComponent(word)}`,
                imageLink: imageLink,
                examples, summary,
                idiom: { text: idiomText, pronunciation: idiomPronunciation, translation: idiomTranslation },
                notes, relatedLanguages,
                submittedBy,
                lastModified: currentDate,
                submitTime: new Date().toLocaleString()
            };

            if (currentEditMode === 'admin_correction' && currentEditIndex >= 0 && currentEditIndex < dictionaryData.length) {
                const originalWord = dictionaryData[currentEditIndex];
                
                wordData.status = 'pending_review';
                wordData.reviewNote = '用户修正版本，等待审核';
                wordData.correctionOf = originalWord.word;
                pendingWords.push(wordData);
                
                alert(`词条"${originalWord.word}"的修正版本"${word}"已提交，等待审核。原词条在审核通过前保持不变。`);
                
            } else if (currentEditMode === 'admin_review' && currentEditIndex >= 0 && currentEditIndex < pendingWords.length) {
                pendingWords[currentEditIndex] = wordData;
                alert(`待审核词条"${word}"已更新。`);
                
                if (document.getElementById('review-panel').style.display === 'block') {
                    loadReviewPanel();
                    highlightPendingItem(currentEditIndex);
                }
                
            } else {
                wordData.status = 'pending_review';
                pendingWords.push(wordData);
                alert(`词条"${word}"已提交，请等待管理员审核发布！`);
            }

            cancelEdit();
            updateAllBadges();
            loadMySubmissionsCarousel();
        }

        function cancelEdit() {
            editFormContainer.style.display = 'none';
            passwordPrompt.style.display = 'none';
            passwordInput.value = '';
            passwordError.style.display = 'none';
            window.afterPasswordVerify = null;
        }

        function deleteCurrentWord() {
            if (currentEditMode === 'admin_edit' && currentEditIndex >= 0 && currentEditIndex < dictionaryData.length) {
                const wordToDelete = dictionaryData[currentEditIndex];
                if (confirm(`确定将词条"${wordToDelete.word}"移入回收站吗？\n\n移入后可以恢复或申诉。`)) {
                    dictionaryData.splice(currentEditIndex, 1);
                    
                    wordToDelete.deletedTime = new Date().toLocaleString();
                    wordToDelete.deletedBy = '管理员';
                    wordToDelete.status = 'deleted';
                    
                    pendingWords = pendingWords.filter(item => item.word !== wordToDelete.word);
                    
                    recycleBin.push(wordToDelete);
                    
                    alert(`词条"${wordToDelete.word}"已移入回收站，相关待审条目已清理。`);
                    cancelEdit();
                    
                    updateAllBadges();
                    loadMySubmissionsCarousel();
                    
                    if (dictionaryData.length > 0) displayWord(dictionaryData[0]);
                    else displayNoResults(true);
                }
            }
        }

        // ==================== 我的投稿状态轮播 ====================
        function loadMySubmissionsCarousel() {
            const allSubmissions = [];
            
            pendingWords.forEach((item, originalIndex) => {
                // 过滤掉管理员提交的词条
                if (item.submittedBy !== '管理员' && item.submittedBy !== '系统管理员') {
                    allSubmissions.push({
                        ...item,
                        type: 'pending',
                        displayStatus: '待审核',
                        originalIndex: originalIndex
                    });
                }
            });
            
            dictionaryData.forEach(item => {
                // 过滤掉管理员提交的词条
                if (item.submittedBy !== '管理员' && item.submittedBy !== '系统管理员') {
                    allSubmissions.push({
                        ...item,
                        type: 'approved',
                        displayStatus: '已批准'
                    });
                }
            });
            
            recycleBin.forEach((item, recycleIndex) => {
                if ((item.status === 'rejected' || item.status === 'deleted') && 
                    item.submittedBy !== '管理员' && item.submittedBy !== '系统管理员') {
                    allSubmissions.push({
                        ...item,
                        type: 'rejected',
                        displayStatus: '被拒绝',
                        rejectReason: item.rejectReason || '未说明原因',
                        recycleIndex: recycleIndex
                    });
                }
            });
            
            carouselItems = allSubmissions;
            
            if (carouselItems.length === 0) {
                carouselTrack.innerHTML = '<div class="carousel-slide"><div class="submission-item" style="display: flex; align-items: center; justify-content: center; color: #666;">暂无投稿记录</div></div>';
                carouselDots.innerHTML = '';
                mySubmissionsCountBadge.style.display = 'none';
                return;
            }
            
            carouselItems.sort((a, b) => {
                const timeA = new Date(a.submitTime || a.lastModified || 0);
                const timeB = new Date(b.submitTime || b.lastModified || 0);
                return timeB - timeA;
            });
            
            updateCarousel();
            
            const pendingRejectedCount = carouselItems.filter(item => item.type === 'pending' || item.type === 'rejected').length;
            if (pendingRejectedCount > 0) {
                mySubmissionsCountBadge.textContent = pendingRejectedCount;
                mySubmissionsCountBadge.style.display = 'flex';
            } else {
                mySubmissionsCountBadge.style.display = 'none';
            }
        }

        function updateCarousel() {
            carouselTrack.innerHTML = '';
            carouselDots.innerHTML = '';
            
            carouselItems.forEach((item, index) => {
                const slide = document.createElement('div');
                slide.className = 'carousel-slide';
                
                const statusClass = item.type === 'pending' ? 'pending' : 
                                  item.type === 'approved' ? 'approved' : 'rejected';
                const statusBadgeClass = item.type === 'pending' ? 'status-pending-badge' : 
                                       item.type === 'approved' ? 'status-approved-badge' : 'status-rejected-badge';
                
                let actionsHTML = '';
                
                if (item.type === 'pending') {
                    // 待审核状态：重投按钮跳转到外置链接
                    actionsHTML = `
                        <a href="https://v.wjx.cn/vm/OZYCfnN.aspx#" target="_blank" class="resubmit-btn">重投</a>
                        <button class="delete-submission-btn" onclick="deleteMySubmission(${index})">删除</button>
                    `;
                } else if (item.type === 'rejected') {
                    // 被拒绝状态：重投按钮跳转到外置链接，保留删除功能
                    actionsHTML = `
                        <a href="https://v.wjx.cn/vm/OZYCfnN.aspx#" target="_blank" class="resubmit-btn">重投</a>
                        <button class="delete-submission-btn" onclick="deleteMySubmission(${index})">删除</button>
                    `;
                } else if (item.type === 'approved') {
                    actionsHTML = `
                        <button class="view-word-btn" onclick="searchAndDisplay('${item.word}')">查看</button>
                    `;
                }
                
                slide.innerHTML = `
                    <div class="submission-item ${statusClass}">
                        <div class="word">${item.word}</div>
                        <div class="pronunciation">${item.pronunciation}</div>
                        <div class="status ${statusBadgeClass}">${item.displayStatus}</div>
                        ${item.type === 'rejected' && item.rejectReason ? `<div class="meta">拒绝理由：${item.rejectReason}</div>` : ''}
                        <div class="meta">提交者：${item.submittedBy || '匿名用户'} | 提交时间：${item.submitTime || item.lastModified || '未知'}</div>
                        <div class="actions">
                            ${actionsHTML}
                        </div>
                    </div>
                `;
                
                carouselTrack.appendChild(slide);
                
                const dot = document.createElement('button');
                dot.className = `carousel-dot ${index === currentSlideIndex ? 'active' : ''}`;
                dot.setAttribute('data-index', index);
                dot.addEventListener('click', () => {
                    goToSlide(index);
                });
                carouselDots.appendChild(dot);
            });
            
            updateCarouselPosition();
        }

        function moveCarousel(direction) {
            const newIndex = currentSlideIndex + direction;
            
            if (newIndex < 0) {
                currentSlideIndex = carouselItems.length - 1;
            } else if (newIndex >= carouselItems.length) {
                currentSlideIndex = 0;
            } else {
                currentSlideIndex = newIndex;
            }
            
            updateCarouselPosition();
        }

        function goToSlide(index) {
            if (index >= 0 && index < carouselItems.length) {
                currentSlideIndex = index;
                updateCarouselPosition();
            }
        }

        function updateCarouselPosition() {
            if (carouselItems.length === 0) return;
            
            const track = document.getElementById('carousel-track');
            const dots = document.querySelectorAll('.carousel-dot');
            
            track.style.transform = `translateX(-${currentSlideIndex * 100}%)`;
            
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentSlideIndex);
            });
        }

        // 编辑我的投稿
        function editMySubmission(originalIndex) {
            if (originalIndex < 0 || originalIndex >= pendingWords.length) return;
            
            currentEditMode = 'user_submit';
            currentEditIndex = originalIndex;
            currentEditOriginalWord = pendingWords[originalIndex].word;
            
            loadEditForm(originalIndex);
            editFormContainer.style.display = 'block';
            passwordPrompt.style.display = 'none';
            deleteWordBtn.style.display = 'none';
            
            editFormContainer.scrollIntoView({ behavior: 'smooth' });
        }

        // 删除我的投稿
        function deleteMySubmission(index) {
            if (index < 0 || index >= carouselItems.length) return;
            
            const item = carouselItems[index];
            
            if (!confirm(`确定要删除投稿"${item.word}"吗？此操作无法撤销！`)) return;
            
            if (item.type === 'pending' && item.originalIndex !== undefined) {
                pendingWords.splice(item.originalIndex, 1);
            } else if (item.type === 'rejected' && item.recycleIndex !== undefined) {
                recycleBin.splice(item.recycleIndex, 1);
            }
            
            alert(`投稿"${item.word}"已删除。`);
            updateAllBadges();
            loadMySubmissionsCarousel();
        }

        // ==================== 重新提交词条功能 ====================
        function resubmitWord(recycleIndex) {
            if (recycleIndex < 0 || recycleIndex >= recycleBin.length) return;
            
            const rejectedWord = recycleBin[recycleIndex];
            
            const wordData = {
                word: rejectedWord.word,
                pronunciation: rejectedWord.pronunciation,
                source: rejectedWord.source || '',
                originalText: rejectedWord.originalText || '',
                grammar: rejectedWord.grammar || '',
                audioLink: rejectedWord.audioLink || `https://www.ximalaya.com/search/${encodeURIComponent(rejectedWord.word)}`,
                imageLink: rejectedWord.imageLink || '',
                examples: rejectedWord.examples || [],
                summary: rejectedWord.summary || '',
                idiom: rejectedWord.idiom || { text: '', pronunciation: '', translation: '' },
                notes: rejectedWord.notes || '',
                relatedLanguages: rejectedWord.relatedLanguages || [],
                submittedBy: rejectedWord.submittedBy || '匿名用户',
                status: 'pending_review',
                reviewNote: '重新提交被拒词条',
                submitTime: new Date().toLocaleString()
            };
            
            pendingWords.push(wordData);
            
            recycleBin.splice(recycleIndex, 1);
            
            alert(`词条"${rejectedWord.word}"已重新提交到待审核列表。`);
            updateAllBadges();
            loadMySubmissionsCarousel();
        }

        // 搜索并显示词条
        function searchAndDisplay(word) {
            searchInput.value = word;
            performSearch(word);
        }

        // ==================== 留言板功能 ====================
        function loadComments() {
            commentsList.innerHTML = '';
            
            const commentsToDisplay = commentSearchActive ? commentSearchResults : comments;
            
            if (commentsToDisplay.length === 0) {
                const message = commentSearchActive ? 
                    '未找到匹配的留言，请尝试其他关键词。' : 
                    '暂无留言';
                commentsList.innerHTML = `<div style="text-align: center; color: #666; padding: 20px;">${message}</div>`;
                return;
            }
            
            const pinnedComments = commentsToDisplay.filter(comment => comment.isPinned);
            const normalComments = commentsToDisplay.filter(comment => !comment.isPinned);
            
            const sortedPinnedComments = [...pinnedComments].sort((a, b) => new Date(b.pinnedTime || b.time) - new Date(a.pinnedTime || a.time));
            const sortedNormalComments = [...normalComments].sort((a, b) => new Date(b.time) - new Date(a.time));
            
            const allSortedComments = [...sortedPinnedComments, ...sortedNormalComments];
            
            allSortedComments.forEach((comment, index) => {
                const originalIndex = comments.findIndex(c => c === comment);
                
                const commentItem = document.createElement('div');
                commentItem.className = `comment-item ${comment.isAdmin ? 'admin-comment' : ''} ${comment.isPinned ? 'pinned-comment' : ''}`;
                
                commentItem.innerHTML = `
                    <div class="comment-actions">
                        <button class="pin-comment-btn ${comment.isPinned ? 'pinned' : ''}" title="${comment.isPinned ? '取消置顶' : '置顶'}" onclick="togglePinComment(${originalIndex})">
                            🔝
                        </button>
                        <button class="delete-comment-btn" title="删除留言" onclick="deleteComment(${originalIndex})">
                            ❌️
                        </button>
                    </div>
                    <div class="comment-header">
                        <span class="comment-author">
                            ${comment.isPinned ? '<span class="crown-icon">👑</span>' : ''}
                            ${comment.author || '匿名用户'}
                            ${comment.isAdmin ? ' <span style="color:#2c5aa0;font-weight:bold;">[管理员]</span>' : ''}
                        </span>
                    </div>
                    <div class="comment-time-container">${comment.time || ''}</div>
                    <div class="comment-content">${comment.content || ''}</div>
                `;
                
                commentsList.appendChild(commentItem);
            });
        }

        function submitComment() {
            const author = commentAuthorInput.value.trim() || '匿名用户';
            const content = commentContentInput.value.trim();
            
            if (!content) {
                alert('请输入留言内容');
                return;
            }
            
            const newComment = {
                author,
                content,
                time: new Date().toLocaleString(),
                isAdmin: author === '管理员',
                isPinned: false
            };
            
            comments.unshift(newComment);
            
            commentAuthorInput.value = '';
            commentContentInput.value = '';
            
            loadComments();
        }

        // ==================== 留言搜索功能 ====================
        function executeCommentSearch() {
            const keyword = commentSearchInput.value.trim().toLowerCase();
            
            if (!keyword) {
                alert('请输入搜索关键词');
                commentSearchInput.focus();
                return;
            }
            
            commentSearchActive = true;
            commentSearchResults = comments.filter(comment => {
                const authorMatch = comment.author && comment.author.toLowerCase().includes(keyword);
                const contentMatch = comment.content && comment.content.toLowerCase().includes(keyword);
                return authorMatch || contentMatch;
            });
            
            loadComments();
        }

        function clearCommentSearch() {
            commentSearchActive = false;
            commentSearchInput.value = '';
            commentSearchResults = [];
            loadComments();
        }

        // ==================== 留言管理功能 ====================
        function togglePinComment(index) {
            if (index < 0 || index >= comments.length) return;
            
            const password = prompt('请输入管理员密码进行置顶操作：');
            if (password !== ADMIN_PASSWORD) {
                alert('密码错误！');
                return;
            }
            
            comments[index].isPinned = !comments[index].isPinned;
            if (comments[index].isPinned) {
                comments[index].pinnedTime = new Date().toLocaleString();
                alert('留言已置顶！');
            } else {
                delete comments[index].pinnedTime;
                alert('留言已取消置顶！');
            }
            
            loadComments();
        }

        function deleteComment(index) {
            if (index < 0 || index >= comments.length) return;
            
            if (!confirm('确定要删除这条留言吗？此操作无法恢复！')) return;
            
            const password = prompt('请输入管理员密码删除留言：');
            if (password !== ADMIN_PASSWORD) {
                alert('密码错误！');
                return;
            }
            
            const deletedComment = comments.splice(index, 1)[0];
            loadComments();
            
            alert(`留言"${deletedComment.content.substring(0, 20)}..."已删除。`);
        }

        // ==================== 徽章通知更新 ====================
        function updateAllBadges() {
            const pendingCount = pendingWords.length;
            if (pendingCount > 0) {
                reviewBadge.textContent = pendingCount;
                reviewBadge.style.display = 'flex';
            } else {
                reviewBadge.style.display = 'none';
            }
            
            const appealCount = recycleBin.filter(item => item.status === 'appeal').length;
            if (appealCount > 0) {
                recycleBadge.textContent = appealCount;
                recycleBadge.style.display = 'flex';
            } else {
                recycleBadge.style.display = 'none';
            }
            
            loadMySubmissionsCarousel();
        }

        // ==================== 修复：清空回收站功能 ====================
        function clearAllRecycleBin() {
            const password = prompt('请输入管理员密码以清空回收站：');
            if (password !== ADMIN_PASSWORD) {
                alert('密码错误！');
                return;
            }
            
            if (!confirm('确定要清空回收站吗？此操作将永久删除所有回收站中的词条（测试词条"厝"除外）。')) {
                return;
            }
            
            const originalRecycleBinLength = recycleBin.length;
            // 修复：只保留测试词条"厝"，删除其他所有词条
            recycleBin = recycleBin.filter(item => item.word === "厝" && item.pronunciation === "cu3");
            
            const removedCount = originalRecycleBinLength - recycleBin.length;
            
            if (removedCount > 0) {
                alert(`回收站已清空！共移除了${removedCount}个词条，保留了测试词条"厝"。`);
            } else {
                alert('回收站已清空（无词条可删除）。');
            }
            
            loadRecycleBin();
            updateAllBadges();
        }

        // ==================== 新增：移除测试词条功能 ====================
        function removeTestWordFromRecycleBin() {
            const originalLength = recycleBin.length;
            recycleBin = recycleBin.filter(item => !(item.word === "厝" && item.pronunciation === "cu3"));
            
            if (recycleBin.length < originalLength) {
                alert('测试词条"厝"已从回收站中移除。');
                loadRecycleBin();
                updateAllBadges();
            }
        }

        // ==================== 新增：导入Excel数据功能（支持Excel文件） ====================
        function importExcelData() {
            const password = prompt('请输入管理员密码以导入Excel数据：');
            if (password !== ADMIN_PASSWORD) {
                alert('密码错误！');
                return;
            }
            
            // 创建文件输入元素
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.csv,.xlsx,.xls,.xlsm';
            fileInput.style.display = 'none';
            
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const data = event.target.result;
                        let rows = [];
                        
                        // 检查文件类型
                        if (file.name.endsWith('.csv')) {
                            // 处理CSV文件
                            rows = parseCSV(data);
                        } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls') || file.name.endsWith('.xlsm')) {
                            // 使用SheetJS库处理Excel文件
                            const workbook = XLSX.read(data, { type: 'binary' });
                            const firstSheetName = workbook.SheetNames[0];
                            const worksheet = workbook.Sheets[firstSheetName];
                            rows = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                        } else {
                            alert('不支持的文件格式。请上传CSV、XLSX或XLS文件。');
                            return;
                        }
                        
                        if (rows.length === 0) {
                            alert('文件中没有数据或解析失败。');
                            return;
                        }
                        
                        // 处理导入的数据
                        processImportedData(rows);
                    } catch (error) {
                        console.error('导入文件时出错:', error);
                        alert('导入文件时出错: ' + error.message);
                    }
                };
                
                reader.onerror = function() {
                    alert('读取文件时出错。');
                };
                
                if (file.name.endsWith('.csv')) {
                    reader.readAsText(file, 'UTF-8');
                } else {
                    reader.readAsBinaryString(file);
                }
            });
            
            // 触发文件选择
            document.body.appendChild(fileInput);
            fileInput.click();
            document.body.removeChild(fileInput);
        }

        function parseCSV(csvText) {
            const rows = [];
            const lines = csvText.split('\n');
            
            // 假设第一行是标题行
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                // 简单的CSV解析，处理引号和逗号
                const columns = [];
                let currentColumn = '';
                let inQuotes = false;
                
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    const nextChar = line[j + 1] || '';
                    
                    if (char === '"' && !inQuotes) {
                        inQuotes = true;
                    } else if (char === '"' && inQuotes && nextChar === '"') {
                        currentColumn += '"';
                        j++; // 跳过下一个引号
                    } else if (char === '"' && inQuotes) {
                        inQuotes = false;
                    } else if (char === ',' && !inQuotes) {
                        columns.push(currentColumn);
                        currentColumn = '';
                    } else {
                        currentColumn += char;
                    }
                }
                
                columns.push(currentColumn);
                rows.push(columns);
            }
            
            return rows;
        }

        function processImportedData(rows) {
            let importedCount = 0;
            let skippedCount = 0;
            
            // 检查是否有标题行
            if (rows.length < 2) {
                alert('文件中没有数据行，请确保至少包含标题行和一数据行。');
                return;
            }
            
            // 从第二行开始处理（跳过标题行）
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                
                try {
                    // 根据用户提供的列对应关系解析数据
                    // 注意：数组索引从0开始，所以字母列减1
                    const submittedBy = row[6] ? row[6].toString().trim() : '匿名用户'; // G列(6) - 您的称呼
                    const word = row[7] ? row[7].toString().trim() : ''; // H列(7) - 词汇
                    const pronunciation = row[8] ? row[8].toString().trim() : ''; // I列(8) - 拼音
                    
                    // 检查必填字段
                    if (!word || !pronunciation) {
                        skippedCount++;
                        continue;
                    }
                    
                    // 检查是否已存在相同词汇
                    const existingWord = dictionaryData.find(item => 
                        item.word === word && item.pronunciation === pronunciation
                    );
                    
                    if (existingWord) {
                        skippedCount++;
                        continue;
                    }
                    
                    // 检查是否已在待审核列表中
                    const existingPending = pendingWords.find(item => 
                        item.word === word && item.pronunciation === pronunciation
                    );
                    
                    if (existingPending) {
                        skippedCount++;
                        continue;
                    }
                    
                    // 构建词条对象 - 按用户提供的列对应关系
                    const examples = [];
                    
                    // 例句1 (Q列=16, R列=17, S列=18)
                    if (row[16] && row[16].toString().trim()) {
                        examples.push({
                            text: row[16].toString().trim(),
                            pronunciation: row[17] ? row[17].toString().trim() : '',
                            translation: row[18] ? row[18].toString().trim() : ''
                        });
                    }
                    
                    // 例句2 (T列=19, U列=20, V列=21)
                    if (row[19] && row[19].toString().trim()) {
                        examples.push({
                            text: row[19].toString().trim(),
                            pronunciation: row[20] ? row[20].toString().trim() : '',
                            translation: row[21] ? row[21].toString().trim() : ''
                        });
                    }
                    
                    // 例句3 (W列=22, X列=23, Y列=24)
                    if (row[22] && row[22].toString().trim()) {
                        examples.push({
                            text: row[22].toString().trim(),
                            pronunciation: row[23] ? row[23].toString().trim() : '',
                            translation: row[24] ? row[24].toString().trim() : ''
                        });
                    }
                    
                    // 构建相关语言对照
                    const relatedLanguages = [];
                    
                    // 相关语言对照 (从AG列=32开始，每3列为一组)
                    for (let langStartCol = 32; langStartCol < row.length; langStartCol += 3) {
                        const languageText = row[langStartCol] ? row[langStartCol].toString().trim() : '';
                        const languagePronunciation = row[langStartCol + 1] ? row[langStartCol + 1].toString().trim() : '';
                        const languageTranslation = row[langStartCol + 2] ? row[langStartCol + 2].toString().trim() : '';
                        
                        if (languageText) {
                            // 解析语言文本，格式为"语言|原文|拼音|翻译"
                            const parts = languageText.split('|').map(part => part.trim());
                            if (parts.length >= 1) {
                                relatedLanguages.push({
                                    language: parts[0] || '其他',
                                    text: parts[1] || '',
                                    pronunciation: parts[2] || languagePronunciation,
                                    translation: parts[3] || languageTranslation
                                });
                            }
                        }
                    }
                    
                    // 构建完整的词条数据对象
                    const wordData = {
                        word,
                        pronunciation,
                        source: row[11] ? row[11].toString().trim() : '', // L列(11) - 出处
                        originalText: row[12] ? row[12].toString().trim() : '', // M列(12) - 原文
                        grammar: row[13] ? row[13].toString().trim() : '', // N列(13) - 语法
                        audioLink: row[9] ? row[9].toString().trim() : `https://www.ximalaya.com/search/${encodeURIComponent(word)}`, // J列(9) - 音频链接
                        imageLink: row[15] ? row[15].toString().trim() : '', // P列(15) - 图片链接
                        examples,
                        summary: row[25] ? row[25].toString().trim() : '', // Z列(25) - 归纳
                        idiom: {
                            text: row[26] ? row[26].toString().trim() : '', // AA列(26) - 俗语文本
                            pronunciation: row[27] ? row[27].toString().trim() : '', // AB列(27) - 俗语拼音
                            translation: row[28] ? row[28].toString().trim() : '' // AC列(28) - 俗语翻译
                        },
                        notes: row[31] ? row[31].toString().trim() : '', // AF列(31) - 备注
                        relatedLanguages,
                        submittedBy: submittedBy || 'Excel导入',
                        status: 'pending_review',
                        reviewNote: '通过Excel导入',
                        submitTime: new Date().toLocaleString(),
                        lastModified: new Date().toISOString().split('T')[0]
                    };
                    
                    // 添加到待审核列表
                    pendingWords.push(wordData);
                    importedCount++;
                    
                } catch (error) {
                    console.error(`处理第${i + 1}行数据时出错:`, error);
                    skippedCount++;
                }
            }
            
            // 更新徽章
            updateAllBadges();
            
            alert(`导入完成！\n成功导入: ${importedCount} 个词条\n跳过重复或无效: ${skippedCount} 个词条\n\n导入的词条已添加到待审核列表，请管理员审核后发布。`);
            
            // 刷新相关面板
            if (document.getElementById('review-panel').style.display === 'block') {
                loadReviewPanel();
            }
            
            loadMySubmissionsCarousel();
        }

        // ==================== 新增：导入留言Excel数据功能 ====================
        function importCommentsExcelData() {
            // 创建文件输入元素
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.csv,.xlsx,.xls,.xlsm';
            fileInput.style.display = 'none';
            
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const data = event.target.result;
                        let rows = [];
                        
                        // 检查文件类型
                        if (file.name.endsWith('.csv')) {
                            // 处理CSV文件
                            rows = parseCSV(data);
                        } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls') || file.name.endsWith('.xlsm')) {
                            // 使用SheetJS库处理Excel文件
                            const workbook = XLSX.read(data, { type: 'binary' });
                            const firstSheetName = workbook.SheetNames[0];
                            const worksheet = workbook.Sheets[firstSheetName];
                            rows = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                        } else {
                            alert('不支持的文件格式。请上传CSV、XLSX或XLS文件。');
                            return;
                        }
                        
                        if (rows.length === 0) {
                            alert('文件中没有数据或解析失败。');
                            return;
                        }
                        
                        // 处理导入的留言数据
                        processImportedCommentsData(rows);
                    } catch (error) {
                        console.error('导入留言文件时出错:', error);
                        alert('导入留言文件时出错: ' + error.message);
                    }
                };
                
                reader.onerror = function() {
                    alert('读取文件时出错。');
                };
                
                if (file.name.endsWith('.csv')) {
                    reader.readAsText(file, 'UTF-8');
                } else {
                    reader.readAsBinaryString(file);
                }
            });
            
            // 触发文件选择
            document.body.appendChild(fileInput);
            fileInput.click();
            document.body.removeChild(fileInput);
        }

        function processImportedCommentsData(rows) {
            let importedCount = 0;
            let skippedCount = 0;
            
            // 根据留言Excel列结构解析数据
            // 假设列顺序：A(0)=序号, B(1)=提交答卷时间, C(2)=所用时间, D(3)=来源, E(4)=来源详情, F(5)=来自IP, G(6)=称呼, H(7)=留言内容
            rows.forEach((row, index) => {
                if (index === 0) return; // 跳过标题行
                
                try {
                    if (row.length < 8) {
                        skippedCount++;
                        return;
                    }
                    
                    const author = row[6] || '匿名用户'; // G列
                    const content = row[7] || ''; // H列
                    const time = row[1] || new Date().toLocaleString(); // B列
                    
                    if (!content.trim()) {
                        skippedCount++;
                        return;
                    }
                    
                    // 检查是否已存在相同留言（基于内容和时间）
                    const existingComment = comments.find(comment => 
                        comment.content === content && comment.time === time
                    );
                    
                    if (existingComment) {
                        skippedCount++;
                        return;
                    }
                    
                    const newComment = {
                        author: author.trim(),
                        content: content.trim(),
                        time: time,
                        isAdmin: author.trim() === '管理员',
                        isPinned: false
                    };
                    
                    comments.unshift(newComment);
                    importedCount++;
                    
                } catch (error) {
                    console.error(`处理第${index + 1}行留言数据时出错:`, error);
                    skippedCount++;
                }
            });
            
            alert(`留言导入完成！\n成功导入: ${importedCount} 条留言\n跳过重复: ${skippedCount} 条留言`);
            
            // 刷新留言列表
            loadComments();
        }

        // ==================== 管理面板功能 ====================
        function toggleRecycleBin() {
            const panel = document.getElementById('recycle-panel');
            if (!panel) return;
            
            const password = prompt('请输入管理员密码查看回收站：');
            if (password !== ADMIN_PASSWORD) {
                alert('密码错误！');
                return;
            }
            
            panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
            if (panel.style.display === 'block') {
                loadRecycleBin();
                recycleBadge.style.display = 'none';
            }
        }

        function loadRecycleBin() {
            const container = document.getElementById('recycle-list');
            if (!container) return;
            
            if (recycleBin.length === 0) {
                container.innerHTML = '<p>回收站是空的。</p>';
                return;
            }
            
            container.innerHTML = recycleBin.map((item, idx) => {
                const isTestWord = item.word === "厝" && item.pronunciation === "cu3";
                
                let statusBadge = '';
                let actions = '';
                
                if (item.status === 'deleted') {
                    statusBadge = '<span class="status-badge status-rejected">已删除</span>';
                    actions = `
                        <button class="success" onclick="restoreWord(${idx})">恢复词条</button>
                        <button class="warning" onclick="appealWord(${idx})">提交申诉</button>
                        <button class="danger" onclick="permanentlyDelete(${idx})">永久删除</button>
                    `;
                } else if (item.status === 'rejected') {
                    statusBadge = '<span class="status-badge status-rejected">已拒绝</span>';
                    actions = `
                        <button class="warning" onclick="appealWord(${idx})">提交申诉</button>
                        <button class="danger" onclick="permanentlyDelete(${idx})">永久删除</button>
                    `;
                } else if (item.status === 'appeal') {
                    statusBadge = '<span class="status-badge status-appeal">待申诉审核</span>';
                    actions = `
                        <button class="success" onclick="approveAppeal(${idx})">批准申诉</button>
                        <button class="danger" onclick="rejectAppeal(${idx})">驳回申诉</button>
                    `;
                }
                
                if (isTestWord) {
                    actions += `<button class="danger" onclick="removeTestWordFromRecycleBin()" style="background-color:#9b59b6;">删除测试词条</button>`;
                }
                
                return `
                    <div class="pending-item ${item.status === 'appeal' ? 'appeal-item' : 'recycle-item'} ${isTestWord ? 'highlighted' : ''}">
                        <strong>${item.word}</strong> <small>(${item.pronunciation})</small> ${statusBadge}
                        ${isTestWord ? '<span style="color:#9b59b6;margin-left:10px;">[测试词条]</span>' : ''}
                        <p>${item.summary || '无描述'}</p>
                        <div class="meta">
                            提交者：${item.submittedBy || '未知'} | 
                            操作时间：${item.deletedTime || item.rejectTime || '未知'} |
                            操作者：${item.deletedBy || item.rejectedBy || '未知'}
                            ${item.rejectReason ? `<br>拒绝理由：${item.rejectReason}` : ''}
                            ${item.appealReason ? `<br>申诉理由：${item.appealReason}</div>` : ''}
                        </div>
                        <div class="actions">${actions}</div>
                    </div>`;
            }).join('');
        }

        function toggleReviewPanel() {
            const panel = document.getElementById('review-panel');
            if (!panel) return;
            
            const password = prompt('请输入管理员密码查看待审核词条：');
            if (password !== ADMIN_PASSWORD) {
                alert('密码错误！');
                return;
            }
            
            panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
            if (panel.style.display === 'block') {
                loadReviewPanel();
                if (highlightedPendingIndex >= 0) {
                    highlightPendingItem(highlightedPendingIndex);
                }
                reviewBadge.style.display = 'none';
            }
        }

        function loadReviewPanel() {
            const container = document.getElementById('review-list');
            if (!container) return;
            
            if (pendingWords.length === 0) {
                container.innerHTML = '<p>暂无待审核词条。</p>';
                return;
            }
            
            container.innerHTML = pendingWords.map((item, idx) => {
                const statusBadge = '<span class="status-badge status-pending">待审核</span>';
                const isHighlighted = idx === highlightedPendingIndex ? 'highlighted' : '';
                
                return `
                    <div class="pending-item ${isHighlighted}" id="pending-item-${idx}">
                        <strong>${item.word}</strong> <small>(${item.pronunciation})</small> ${statusBadge}
                        <p>${item.summary || '无描述'}</p>
                        <div class="meta">
                            提交者：${item.submittedBy || '匿名用户'} | 
                            提交时间：${item.submitTime || '未知'}
                            ${item.reviewNote ? `<br>备注：${item.reviewNote}` : ''}
                            ${item.correctionOf ? `<br>修正自：${item.correctionOf}` : ''}
                        </div>
                        <div class="actions">
                            <button class="success" onclick="approveWord(${idx})">批准发布</button>
                            <button class="danger" onclick="rejectWord(${idx})">拒绝</button>
                            <button class="info" onclick="editPendingWord(${idx})">编辑</button>
                            <button class="warning" onclick="deletePendingWord(${idx})">删除</button>
                        </div>
                    </div>`;
            }).join('');
        }

        function deletePendingWord(index) {
            if (index < 0 || index >= pendingWords.length) return;
            
            const wordToDelete = pendingWords[index];
            if (!confirm(`确定要删除待审核词条"${wordToDelete.word}"吗？此操作无法撤销！`)) return;
            
            pendingWords.splice(index, 1);
            
            alert(`待审核词条"${wordToDelete.word}"已删除。`);
            loadReviewPanel();
            updateAllBadges();
            loadMySubmissionsCarousel();
        }

        function highlightPendingItem(index) {
            document.querySelectorAll('.pending-item.highlighted').forEach(item => {
                item.classList.remove('highlighted');
            });
            
            highlightedPendingIndex = index;
            
            const itemElement = document.getElementById(`pending-item-${index}`);
            if (itemElement) {
                itemElement.classList.add('highlighted');
            }
        }

        // ==================== 修复：批准词条功能（解决重复词条问题） ====================
        function approveWord(index) {
            const wordToApprove = pendingWords[index];
            const wordText = wordToApprove.word;
            const pronunciation = wordToApprove.pronunciation;
            
            // 检查是否已有完全相同的词条
            const existingIndex = dictionaryData.findIndex(item => 
                item.word === wordText && item.pronunciation === pronunciation
            );
            
            // 如果是修正版本（有correctionOf字段），应该替换原词条
            if (wordToApprove.correctionOf) {
                // 查找原词条
                const originalIndex = dictionaryData.findIndex(item => item.word === wordToApprove.correctionOf);
                
                if (originalIndex >= 0) {
                    // 将原词条移入回收站
                    const originalWord = dictionaryData[originalIndex];
                    originalWord.deletedTime = new Date().toLocaleString();
                    originalWord.deletedBy = '管理员';
                    originalWord.status = 'replaced';
                    originalWord.replacedBy = wordText;
                    originalWord.replacedByWord = wordToApprove;
                    recycleBin.push(originalWord);
                    
                    // 从正式库移除原词条
                    dictionaryData.splice(originalIndex, 1);
                }
                
                // 删除修正标记，将修正版本加入正式库
                delete wordToApprove.status;
                delete wordToApprove.reviewNote;
                delete wordToApprove.correctionOf;
                
                wordToApprove.lastModified = new Date().toISOString().split('T')[0];
                dictionaryData.push(wordToApprove);
                
                // 从待审核列表移除
                pendingWords.splice(index, 1);
                
                alert(`已批准发布修正词条"${wordText}"，原词条已移入回收站。`);
                
            } else if (existingIndex >= 0) {
                // 如果不是修正版本，但已有完全相同的词条，则不能批准
                alert(`无法批准：词条"${wordText}"已存在于正式词库中。`);
                return;
            } else {
                // 如果是新词条，直接加入
                delete wordToApprove.status;
                delete wordToApprove.reviewNote;
                
                wordToApprove.lastModified = new Date().toISOString().split('T')[0];
                dictionaryData.push(wordToApprove);
                
                pendingWords.splice(index, 1);
                
                alert(`已批准发布词条"${wordText}"。`);
            }
            
            // 清理其他同名待审词条
            const otherPendingWithSameName = pendingWords.filter((item, idx) => 
                item.word === wordText
            );
            
            otherPendingWithSameName.forEach(otherWord => {
                const otherIndex = pendingWords.findIndex(item => item.word === wordText);
                if (otherIndex >= 0) {
                    const removedWord = pendingWords.splice(otherIndex, 1)[0];
                    removedWord.status = 'rejected';
                    removedWord.rejectTime = new Date().toLocaleString();
                    removedWord.rejectedBy = '系统自动处理';
                    removedWord.rejectReason = '因同名词条已通过审核';
                    recycleBin.push(removedWord);
                }
            });
            
            loadReviewPanel();
            updateAllBadges();
            loadMySubmissionsCarousel();
            
            if (dictionaryData.length > 0) {
                const newIndex = dictionaryData.findIndex(item => item.word === wordText);
                displayWord(dictionaryData[newIndex]);
            }
            
            highlightedPendingIndex = -1;
        }

        function rejectWord(index) {
            const wordToReject = pendingWords[index];
            const rejectReason = prompt(`请输入拒绝"${wordToReject.word}"的理由：`);
            
            if (!rejectReason || rejectReason.trim() === '') {
                alert('拒绝理由不能为空。');
                return;
            }
            
            pendingWords.splice(index, 1);
            
            wordToReject.status = 'rejected';
            wordToReject.rejectTime = new Date().toLocaleString();
            wordToReject.rejectedBy = '管理员';
            wordToReject.rejectReason = rejectReason.trim();
            recycleBin.push(wordToReject);
            
            alert(`已拒绝词条"${wordToReject.word}"，并移入回收站。`);
            loadReviewPanel();
            updateAllBadges();
            loadMySubmissionsCarousel();
            highlightedPendingIndex = -1;
        }

        function editPendingWord(index) {
            currentEditMode = 'admin_review';
            currentEditIndex = index;
            currentEditOriginalWord = pendingWords[index].word;
            
            highlightedPendingIndex = index;
            
            loadEditForm(index);
            editFormContainer.style.display = 'block';
            passwordPrompt.style.display = 'none';
            deleteWordBtn.style.display = 'none';
            
            document.getElementById('review-panel').style.display = 'none';
            editFormContainer.scrollIntoView({ behavior: 'smooth' });
        }

        function restoreWord(index) {
            const wordToRestore = recycleBin[index];
            
            const isInDictionary = dictionaryData.some(item => item.word === wordToRestore.word && item.pronunciation === wordToRestore.pronunciation);
            
            if (isInDictionary) {
                alert(`无法恢复：词条"${wordToRestore.word}"已存在于正式词库中。`);
                return;
            }
            
            recycleBin.splice(index, 1);
            
            pendingWords = pendingWords.filter(item => item.word !== wordToRestore.word);
            
            delete wordToRestore.status;
            delete wordToRestore.deletedTime;
            delete wordToRestore.deletedBy;
            delete wordToRestore.rejectReason;
            delete wordToRestore.rejectTime;
            delete wordToRestore.rejectedBy;
            
            wordToRestore.lastModified = new Date().toISOString().split('T')[0];
            
            dictionaryData.push(wordToRestore);
            
            alert(`已恢复词条"${wordToRestore.word}"。`);
            loadRecycleBin();
            updateAllBadges();
            loadMySubmissionsCarousel();
            
            if (dictionaryData.length > 0) {
                const restoredIndex = dictionaryData.findIndex(item => item.word === wordToRestore.word);
                displayWord(dictionaryData[restoredIndex]);
            }
        }

        function permanentlyDelete(index) {
            if (!confirm('确定要永久删除此词条吗？此操作无法撤销！')) return;
            
            const wordToDelete = recycleBin[index].word;
            
            recycleBin.splice(index, 1);
            
            const pendingBefore = pendingWords.length;
            pendingWords = pendingWords.filter(item => item.word !== wordToDelete);
            
            alert(`词条"${wordToDelete}"已永久删除，相关待审条目已清理。`);
            loadRecycleBin();
            updateAllBadges();
        }

        function appealWord(index) {
            const wordToAppeal = recycleBin[index];
            const appealReason = prompt(`请说明申诉"${wordToAppeal.word}"的理由：`);
            
            if (!appealReason || appealReason.trim() === '') {
                alert('申诉理由不能为空。');
                return;
            }
            
            wordToAppeal.status = 'appeal';
            wordToAppeal.appealTime = new Date().toLocaleString();
            wordToAppeal.appealReason = appealReason.trim();
            
            alert('申诉已提交，等待管理员审核。');
            loadRecycleBin();
            updateAllBadges();
        }

        function approveAppeal(index) {
            const wordToApprove = recycleBin[index];
            
            const isInDictionary = dictionaryData.some(item => item.word === wordToApprove.word && item.pronunciation === wordToApprove.pronunciation);
            
            if (isInDictionary) {
                alert(`无法批准申诉：词条"${wordToApprove.word}"已存在于正式词库中。`);
                return;
            }
            
            recycleBin.splice(index, 1);
            
            delete wordToApprove.status;
            delete wordToApprove.appealTime;
            delete wordToApprove.appealReason;
            wordToApprove.status = 'pending_review';
            wordToApprove.reviewNote = '通过申诉重新提交，等待审核';
            pendingWords.push(wordToApprove);
            
            alert(`已批准申诉，词条"${wordToApprove.word}"已重新进入待审核列表。`);
            loadRecycleBin();
            updateAllBadges();
        }

        function rejectAppeal(index) {
            const rejectReason = prompt('请输入驳回申诉的理由：');
            if (!rejectReason || rejectReason.trim() === '') {
                alert('驳回理由不能为空。');
                return;
            }
            
            const wordToReject = recycleBin[index];
            wordToReject.status = 'rejected';
            wordToReject.appealRejectTime = new Date().toLocaleString();
            wordToReject.appealRejectReason = rejectReason.trim();
            
            alert('申诉已驳回。');
            loadRecycleBin();
            updateAllBadges();
        }

        // ==================== 全局函数导出 ====================
        window.removeExample = removeExample;
        window.addExample = addExample;
        window.startCorrection = startCorrection;
        window.startUserSubmit = startUserSubmit;
        window.restoreWord = restoreWord;
        window.permanentlyDelete = permanentlyDelete;
        window.appealWord = appealWord;
        window.approveAppeal = approveAppeal;
        window.rejectAppeal = rejectAppeal;
        window.editPendingWord = editPendingWord;
        window.approveWord = approveWord;
        window.rejectWord = rejectWord;
        window.deletePendingWord = deletePendingWord;
        window.editMySubmission = editMySubmission;
        window.deleteMySubmission = deleteMySubmission;
        window.resubmitWord = resubmitWord;
        window.searchAndDisplay = searchAndDisplay;
        window.deleteComment = deleteComment;
        window.togglePinComment = togglePinComment;
        window.removeTestWordFromRecycleBin = removeTestWordFromRecycleBin;
        window.clearAllRecycleBin = clearAllRecycleBin;
        window.importExcelData = importExcelData;
        window.reloadData = reloadData;
    </script>
</body>
</html>